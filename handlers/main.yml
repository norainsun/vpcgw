---
- name: Start mysql
  service: name=mysql state=started
#
#- name: Reload Nginx
#  service: name=nginx state=reloaded

- name: Create usermaster schema
  when:
  shell: mysql < /opt/sql/vpcgw_um.sql


- name: Create mobilemaster schema
  shell: mysql < /opt/sql/vpcgw_mm.sql


- name: Create message schema
  shell: mysql < /opt/sql/vpcgw_msg.sql


- name: Create cloud schema
  shell: mysql < /opt/sql/vpcgw_cloud.sql




- name: Import cfg into redis db0
  shell: cat /opt/rds_data/rds_gwcfg | redis-cli --pipe


- name: Import permission into redis db2
  shell: cat /opt/rds_data/rds_gwpermission | redis-cli -n 2 --pipe


- name: Copy app cfg
  copy: src=tomcat/{{ item }} dest=/etc/tomcat7/Catalina/localhost/
  with_items: 
    - api.xml
    - usermaster.xml
    - webmail.xml

- name: Copy cataliana shell script
  copy: src=tomcat/catalina.sh  dest=/usr/share/tomcat7/bin/


- name: Copy catalian properties
  copy: src=tomcat/catalina.properties  dest=/etc/tomcat7/


- name: Copy webapps
  copy: src=webapps  dest=/datayes/



